<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Daftar Dosen</title>
  </head>
  <body>
    <h1>Daftar Dosen</h1>
    <ul id="dosenList">
      Loading...
    </ul>

    <!-- Socket.IO CDN -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <script>
      const dosenList = document.getElementById("dosenList");

      // Fungsi untuk render data dosen ke dalam <ul>
      function renderDosen(data) {
        dosenList.innerHTML = ""; // Kosongkan dulu
        data.forEach((dosen) => {
          const li = document.createElement("li");
          li.textContent = dosen.nama || JSON.stringify(dosen); // fallback kalau tidak ada nama
          dosenList.appendChild(li);
        });
      }

      // Ambil data awal dari API
      fetch("http://localhost:3000/api/daftar-dosen")
        .then((res) => res.json())
        .then((data) => {
          console.log("📥 Data dari API:", data);
          renderDosen(data);
        })
        .catch((err) => {
          dosenList.innerHTML = "<li>Gagal mengambil data</li>";
          console.error("❌ Gagal fetch:", err);
        });

      // Inisialisasi Socket.IO
      const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTYsInJvbGUiOiJkb3NlbiIsImlhdCI6MTc0NzU2MTQyNCwiZXhwIjoxNzQ3NjQ3ODI0fQ.Qe-VY9sOdJZLuqhqstZEFUum5d6qrDJcjfnIipwam7g"; // gunakan jika ada sistem login
      const socket = io({
        auth: {
          token: token,
        },
      });

      socket.on("connect", () => {
        console.log("✅ Socket terhubung:", socket.id);
      });

      socket.on("connect_error", (err) => {
        console.error("❌ Gagal koneksi socket:", err.message);
      });

      // Event real-time update dari server
      socket.on("updateDaftarDosen", (data) => {
        console.log("📡 Data baru dari socket:", data);
        renderDosen(data);
      });
    </script>
  </body>
</html>
